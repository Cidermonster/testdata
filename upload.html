<!DOCTYPE html>
<html>
<link href="./upload.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="js/upload.js"></script>
<label class="upload-label">
	写真をフォルダから選択してください
	<input type="file">
  </label>
	  <div x-data="app">
  
  <div x-show="showUpload">
    <img :src="preview">
    ファイル選択
    <input id="inputFile" @change="fileSelected" type="file" required>
    <button @click="upload()" :class="buttonStyle">アップロード</button>
  </div>

</div>

<script type="module">
  import Alpine from "https://unpkg.com/alpinejs@3.2.3/dist/module.esm.js"
  import { fetchJSON } from "https://ninja03.github.io/denokun/lib/fetchJSON.js"
  import { ImageUploader } from "https://ninja03.github.io/denokun/lib/ImageUploader.js"

  Alpine.data("app", () => ({

    // アップロードするファイルを選んだ
    fileSelected() {
      const reader = new FileReader()
      reader.onload = () => { this.preview = reader.result }
      reader.readAsDataURL(inputFile.files[0])
    },

    // アップロードする
    upload() {
      const f = inputFile.files[0]
      let up = new ImageUploader(this.server + "/data/")
      // 最大幅1200px、最大ファイルサイズ1メガバイト
      up.setFile(f, 1200, 1024 * 1024)
      up.onload = async url => {
        await this.fetchAPI("post", { url })
        this.up = f.name
        console.log("「" + this.up + "をアップしました")
        this.closeUpload()
        this.reloadTimeline()
      }
    }
  }))

</script>
</html>
